{% extends 'financas/base.html' %}

{% block title %}Editar Conta{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-6 offset-md-3">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Editar Conta</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="nome" class="form-label">Nome da Conta</label>
                            <input type="text" class="form-control" id="nome" name="nome" value="{{ conta.nome }}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Tipo de Conta</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="tipo" id="tipo_simples" value="simples" 
                                       {% if not conta.is_conta_bancaria %}checked{% endif %} onchange="toggleCamposBancarios()">
                                <label class="form-check-label" for="tipo_simples">
                                    Conta Simples
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="tipo" id="tipo_bancaria" value="bancaria" 
                                       {% if conta.is_conta_bancaria %}checked{% endif %} onchange="toggleCamposBancarios()">
                                <label class="form-check-label" for="tipo_bancaria">
                                    Conta Bancária
                                </label>
                            </div>
                        </div>
                        
                        <div id="campos-bancarios" style="{% if not conta.is_conta_bancaria %}display: none;{% endif %}">
                            <div class="mb-3">
                                <label for="banco" class="form-label">Banco</label>
                                <select class="form-select" id="banco" name="banco">
                                    <option value="">Selecione um banco</option>
                                    {% for banco in bancos %}
                                    <option value="{{ banco.id }}" {% if conta.banco and conta.banco.id == banco.id %}selected{% endif %}>
                                        {{ banco.codigo }} - {{ banco.nome }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="cnpj" class="form-label">CNPJ</label>
                                <input type="text" class="form-control" id="cnpj" name="cnpj" value="{{ conta.cnpj }}" 
                                       placeholder="00.000.000/0000-00" maxlength="18">
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="agencia" class="form-label">Agência</label>
                                        <input type="text" class="form-control" id="agencia" name="agencia" value="{{ conta.agencia }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="numero_conta" class="form-label">Número da Conta</label>
                                        <input type="text" class="form-control" id="numero_conta" name="numero_conta" value="{{ conta.numero_conta }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <a href="{% url 'dashboard' %}" class="btn btn-secondary">Cancelar</a>
                            <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function toggleCamposBancarios() {
    const tipoSimples = document.getElementById('tipo_simples');
    const camposBancarios = document.getElementById('campos-bancarios');
    
    if (tipoSimples.checked) {
        camposBancarios.style.display = 'none';
        // Limpar valores dos campos bancários
        document.getElementById('banco').value = '';
        document.getElementById('cnpj').value = '';
        document.getElementById('agencia').value = '';
        document.getElementById('numero_conta').value = '';
    } else {
        camposBancarios.style.display = 'block';
    }
}

// Máscara para CNPJ
document.getElementById('cnpj').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    value = value.replace(/(\d{2})(\d)/, '$1.$2');
    value = value.replace(/(\d{3})(\d)/, '$1.$2');
    value = value.replace(/(\d{3})(\d)/, '$1/$2');
    value = value.replace(/(\d{4})(\d)/, '$1-$2');
    e.target.value = value;
});
</script>
{% endblock %}